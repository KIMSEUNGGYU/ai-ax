---
description: 세션 마무리 — 상태 저장 + 활동 로그 + 습관 점수
allowed-tools: Read, Write, Glob, Bash
argument-hint: [저장할 파일명 (선택)]
---

세션 종료 시 3 Phase로 상태 저장 + 활동 로그 생성 + 습관 점수 기록.

## Phase 1: 상태 저장 (기존)

### 수집할 정보

1. **Git 상태**
   - 현재 브랜치
   - 최근 커밋 (3~5개)
   - 변경사항 (staged/unstaged)

2. **작업 컨텍스트**
   - 무슨 작업 중이었는지 (1~2줄)
   - 주요 결정사항 + 이유

3. **진행 상황**
   - 완료된 것
   - 진행 중인 것
   - 남은 것

4. **다음 액션**
   - 바로 이어서 할 것 (구체적으로)
   - 블로커/주의사항

### 저장 대상

#### `.ai/STATUS.md` (덮어쓰기)

세션 간 상태 전달의 단일 진실 공급원. 매번 전체를 덮어쓴다.

```markdown
# 작업 상태

> 마지막 업데이트: {날짜}

## 현재 진행 중

- [{트랙}] {작업 설명}
  - {세부 항목}

## 다음 할 일

1. {구체적 액션}

## 최근 결정

- {결정 요약}

## 블로커

- {블로커 설명} (없으면 "없음")
```

#### `.ai/DECISIONS.md` (누적 추가)

이번 세션에서 내린 주요 결정이 있으면 날짜 섹션 아래에 추가한다.
기존 내용은 삭제하지 않는다.

```markdown
## {날짜}

### {결정 제목}
- {내용}
- 이유: {근거}
```

## Phase 2: 세션 로그 생성

대화 컨텍스트를 분석해서 `.ai/logs/sessions/{YYYY-MM-DD}_{id}.md`에 세션 로그를 생성한다.

`{id}`는 4자리 랜덤 hex (예: `2026-02-09_a1b2.md`).

### 로그 형식

```markdown
---
session_id: "{YYYY-MM-DD}_{id}"
date: "{YYYY-MM-DD}"
fe_quality_avg: {/review 점수 평균, 없으면 null}
ai_collab_score: {AI 협업 점수 /10}
---

## 실행 커맨드

| 시각 | 커맨드 | 입력 | 산출물 |
|------|--------|------|--------|
| {대략적 시각} | {커맨드명} | {입력 요약} | {결과 요약} |

## 리뷰 점수

{/review 실행 결과가 있으면 점수 테이블, 없으면 "이번 세션에서 /review 미실행"}

## AI 협업 패턴

| 항목 | 점수 | 근거 |
|------|------|------|
| 설계 후 구현 (/architecture → 구현) | /2 | {있었는지} |
| 리뷰 실행 (/review) | /2 | {있었는지} |
| 피드백 반영 후 재리뷰 | /2 | {있었는지} |
| plan 모드 활용 | /1 | {있었는지} |
| 커밋 단위 (기능별 분리) | /2 | {git log 기반 판단} |
| 문서화 (/recap or 작업 정리) | /1 | {있었는지} |
| **합계** | **{총점}/10** | |
```

### AI 협업 점수 산정 기준

| 항목 | 배점 | 기준 |
|------|------|------|
| 설계 후 구현 | 2 | /architecture 실행 후 구현 진행 |
| 리뷰 실행 | 2 | /review 1회 이상 실행 |
| 피드백 반영 후 재리뷰 | 2 | /review → 수정 → /review 재실행 |
| plan 모드 활용 | 1 | plan 모드 1회 이상 사용 |
| 커밋 단위 | 2 | 기능별로 커밋 분리 (git log 기반) |
| 문서화 | 1 | 작업 내용을 md로 정리 |

**중요**: 대화 컨텍스트에서 실제로 확인된 항목만 점수를 부여한다. 추측하지 않는다.

## Phase 3: 습관 점수 기록

`.ai/logs/habit-score.md`에 행을 추가한다.

파일이 없으면 헤더와 함께 생성:

```markdown
# 습관 점수

| 날짜 | 세션 ID | FE 품질 평균 | AI 협업 점수 | 메모 |
|------|---------|-------------|-------------|------|
```

기존 파일이 있으면 테이블 마지막에 행을 추가:

```markdown
| {날짜} | {세션 ID} | {점수 또는 -} | {점수}/10 | {한줄 요약} |
```

## 실행 순서

1. Phase 1 → STATUS.md 덮어쓰기 + DECISIONS.md 누적
2. Phase 2 → 세션 로그 생성
3. Phase 3 → habit-score.md에 행 추가
4. 대화에 요약 출력: 저장 위치 + AI 협업 점수 + 다음 세션 팁

## 원칙
- 간결하게 (빠른 파악용)
- 코드 복붙 금지 (경로만)
- 결정 이유 필수
- STATUS.md는 항상 전체 덮어쓰기
- DECISIONS.md는 항상 누적 (기존 내용 유지)
- 점수는 대화 컨텍스트에서 확인된 것만 (추측 금지)
